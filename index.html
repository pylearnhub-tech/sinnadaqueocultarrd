<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Peri√≥dico Digital ‚Äî Noticias en tiempo real</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root {
      --bg: #0b0e12;
      --surface: #12161c;
      --elev: #181d25;
      --text: #e6edf3;
      --muted: #9aa6b2;
      --primary: #4aa3ff;
      --accent: #22d3ee;
      --danger: #f87171;
      --ok: #34d399;
      --border: #2a313b;
      --shadow: 0 8px 24px rgba(0,0,0,.35);
      --radius: 14px;
      --radius-sm: 10px;
      --radius-xs: 8px;
      --focus: 0 0 0 3px rgba(74,163,255,.35);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(1200px 600px at 10% -30%, rgba(68,152,255,.06), transparent 55%),
                  radial-gradient(1200px 600px at 100% -40%, rgba(34,211,238,.06), transparent 55%),
                  var(--bg);
      color: var(--text);
    }

    /* Layout */
    .app {
      display: grid;
      grid-template-columns: 300px minmax(0,760px) 360px;
      gap: 24px;
      max-width: 1440px;
      margin: 0 auto;
      padding: 24px;
    }
    @media (max-width: 1200px) {
      .app { grid-template-columns: 260px minmax(0,1fr); }
      .right { display:none; }
    }
    @media (max-width: 860px) {
      .app { grid-template-columns: minmax(0,1fr); padding: 12px; }
      .left { display:none; }
    }

    /* Panels */
    .panel {
      background: linear-gradient(180deg, rgba(255,255,255,.02), transparent 40%) , var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      position: relative;
      overflow: clip;
    }

    /* Sidebar */
    .brand {
      display: flex; align-items: center; gap: 12px;
      padding: 18px 18px 12px;
    }
    .logo {
      width: 36px; height: 36px; border-radius: 9px;
      background:
        conic-gradient(from 120deg, #4aa3ff, #22d3ee, #4aa3ff);
      box-shadow: 0 8px 20px rgba(74,163,255,.4);
    }
    .brand h1 { font-size: 18px; margin: 0; letter-spacing: .2px; }
    .nav { padding: 10px; }
    .nav button {
      width: 100%; text-align: left;
      padding: 12px 14px; border-radius: var(--radius-sm);
      background: transparent; border: 1px solid transparent; color: var(--text);
      display: flex; align-items: center; gap: 10px; cursor: pointer;
    }
    .nav button:hover { background: #151a22; border-color: var(--border); }
    .nav .active { background: #161b23; border-color: var(--border); }

    /* Auth panel */
    .auth {
      padding: 18px;
      border-top: 1px solid var(--border);
    }
    .auth h3 { margin: 0 0 10px; font-size: 15px; color: var(--muted); }
    .auth .user {
      display: flex; align-items: center; gap: 12px;
      padding: 12px; border-radius: var(--radius-sm);
      background: #151a20; border: 1px solid var(--border);
    }
    .avatar {
      width: 36px; height: 36px; border-radius: 50%;
      background: linear-gradient(135deg, #4aa3ff, #22d3ee);
      box-shadow: 0 6px 16px rgba(34,211,238,.35);
    }
    .user .meta { display: grid; }
    .user .meta .name { font-weight: 600; }
    .user .meta .handle { color: var(--muted); font-size: 13px; }

    /* Compose floating button */
    .compose-btn {
      position: fixed; z-index: 50;
      right: 24px; bottom: 24px;
      background: linear-gradient(135deg, #4aa3ff, #22d3ee);
      color: #0a0d12; font-weight: 700;
      padding: 14px 18px; border: none; border-radius: 999px;
      box-shadow: 0 8px 26px rgba(34,211,238,.35);
      display: flex; align-items: center; gap: 10px; cursor: pointer;
    }
    .compose-btn:hover { filter: brightness(1.08); }
    .compose-btn:focus { outline: none; box-shadow: var(--focus); }

    /* Feed header */
    .feed-header {
      display: flex; align-items: center; justify-content: space-between;
      padding: 14px 18px; border-bottom: 1px solid var(--border);
      position: sticky; top: 0; background: rgba(18,22,28,.85); backdrop-filter: blur(8px);
      z-index: 10;
    }
    .feed-header h2 { margin: 0; font-size: 18px; letter-spacing: .2px; }
    .filters { display:flex; gap: 8px; }
    .chip {
      padding: 8px 12px; border-radius: 999px; border: 1px solid var(--border);
      background: #141922; color: var(--muted); cursor: pointer; font-size: 13px;
    }
    .chip.active { color: var(--text); border-color: #344154; }

    /* Composer modal */
    .modal {
      position: fixed; inset: 0; display: none; place-items: center; z-index: 100;
      background: rgba(5,8,12,.6); backdrop-filter: blur(6px);
    }
    .modal.open { display: grid; }
    .dialog {
      width: min(820px, 92vw);
      background: var(--surface);
      border: 1px solid var(--border); border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      animation: pop .18s ease-out;
    }
    @keyframes pop { from { transform: scale(.98); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .dialog .head {
      display:flex; align-items:center; justify-content: space-between;
      padding: 14px 16px; border-bottom: 1px solid var(--border);
    }
    .dialog .head h3 { margin:0; font-size:16px; }
    .dialog .body { padding: 16px; display: grid; gap: 12px; }
    .row { display: grid; gap: 8px; }
    label { font-size: 13px; color: var(--muted); }
    input[type="text"], input[type="email"], input[type="password"], textarea {
      width: 100%; padding: 12px 12px; border-radius: var(--radius-xs);
      border: 1px solid #303846; background: #12161c; color: var(--text);
    }
    textarea { min-height: 140px; resize: vertical; }
    .media-picker {
      display: grid; gap: 8px;
      border: 1px dashed #384355; border-radius: var(--radius-xs);
      padding: 12px; background: #121822;
    }
    .media-actions { display:flex; gap:8px; flex-wrap: wrap; }
    .btn {
      padding: 10px 12px; border-radius: 10px; border: 1px solid #2f3847;
      background: #141a23; color: var(--text); cursor: pointer; font-weight: 600;
    }
    .btn.primary { background: linear-gradient(135deg, #4aa3ff, #22d3ee); color: #071018; border: none; }
    .btn.danger { background: #1a1416; color: #fca5a5; border-color: #482b33; }
    .btn.ghost { background: transparent; border-color: transparent; color: var(--muted); }
    .actions { display:flex; gap: 8px; justify-content: flex-end; padding: 10px 16px; border-top: 1px solid var(--border); }

    .previews { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; }
    .preview {
      position: relative; border: 1px solid #303846; border-radius: 10px; overflow: hidden;
      background: #0e1217;
    }
    .preview img, .preview video { width: 100%; height: 120px; object-fit: cover; display: block; }
    .preview .remove {
      position: absolute; top: 6px; right: 6px;
      background: rgba(0,0,0,.45); color: #fff; border: none; border-radius: 8px;
      padding: 6px 8px; cursor: pointer; font-size: 12px;
    }

    /* Feed */
    .feed { min-height: 60vh; }
    .card {
      border-bottom: 1px solid var(--border);
      padding: 14px 18px; display: grid; gap: 12px;
      animation: fadeIn .22s ease-out;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(6px);} to { opacity: 1; transform: translateY(0);} }
    .card .meta { display:flex; gap:8px; align-items:center; color: var(--muted); font-size: 13px; }
    .card h3 { margin: 0; font-size: 18px; letter-spacing: .2px; }
    .card p { margin: 0; color: #cbd5e1; line-height: 1.5; }
    .gallery { display: grid; gap: 8px; grid-template-columns: repeat(2, 1fr); }
    .gallery img, .gallery video { width: 100%; border-radius: 12px; border: 1px solid #2a313b; background: #0f1318; }
    .toolbar { display:flex; gap: 10px; align-items:center; color: var(--muted); font-size: 13px; }
    .toolbar button { background: transparent; color: var(--muted); border: 1px solid transparent; padding: 6px 10px; border-radius: 999px; cursor: pointer; }
    .toolbar button:hover { border-color: #344154; color: var(--text); }

    /* Right panel */
    .right .section { padding: 14px 18px; border-bottom: 1px solid var(--border); }
    .right h3 { margin: 0 0 8px; font-size: 16px; }
    .trend { display:grid; gap: 4px; padding: 10px; border-radius: 12px; }
    .trend:hover { background: #141a22; }
    .trend .kicker { color: var(--muted); font-size: 12px; }
    .trend .title { font-weight: 600; }

    /* Toast */
    .toast {
      position: fixed; left: 50%; bottom: 20px; transform: translateX(-50%);
      background: #0d141d; border: 1px solid #384355; color: var(--text);
      padding: 10px 14px; border-radius: 12px; box-shadow: var(--shadow);
      display: none; z-index: 200;
    }
    .toast.show { display: inline-block; }

    /* Error */
    .error { color: #fca5a5; font-size: 13px; }

    /* Utility */
    .hidden { display:none !important; }
  </style>
</head>
<body>
  <div class="app">
    <!-- LEFT -->
    <aside class="left panel">
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <h1>Peri√≥dico Digital</h1>
      </div>
      <div class="nav">
        <button class="active" data-view="latest">üì∞ √öltimas</button>
        <button data-view="local">üìç Local</button>
        <button data-view="world">üåç Mundo</button>
        <button data-view="tech">üíª Tecnolog√≠a</button>
        <button data-view="sports">üèÖ Deportes</button>
      </div>

      <div class="auth">
        <h3>Tu cuenta</h3>
        <div id="authSigned" class="user hidden">
          <div class="avatar" aria-hidden="true"></div>
          <div class="meta">
            <span class="name" id="userName">‚Äî</span>
            <span class="handle" id="userHandle">@‚Äî</span>
          </div>
        </div>

        <div id="authActions" style="display:grid; gap:10px; margin-top:10px;">
          <button class="btn" id="openLogin">Iniciar sesi√≥n</button>
          <button class="btn" id="openRegister">Crear cuenta</button>
          <button class="btn danger hidden" id="logout">Cerrar sesi√≥n</button>
        </div>
      </div>
    </aside>

    <!-- CENTER -->
    <main class="center panel">
      <div class="feed-header">
        <h2>Portada</h2>
        <div class="filters">
          <button class="chip active" data-filter="all">Todo</button>
          <button class="chip" data-filter="video">Videos</button>
          <button class="chip" data-filter="image">Im√°genes</button>
          <button class="chip" data-filter="text">Solo texto</button>
        </div>
      </div>

      <section class="feed" id="feed"></section>
    </main>

    <!-- RIGHT -->
    <aside class="right panel">
      <div class="section">
        <h3>Tendencias</h3>
        <div class="trend">
          <span class="kicker">HOY</span>
          <span class="title">Nueva infraestructura vial en la ciudad</span>
        </div>
        <div class="trend">
          <span class="kicker">TECNO</span>
          <span class="title">IA generativa impulsa la productividad</span>
        </div>
        <div class="trend">
          <span class="kicker">DEPORTES</span>
          <span class="title">El cl√°sico se define en los √∫ltimos minutos</span>
        </div>
      </div>
      <div class="section">
        <h3>Bolet√≠n</h3>
        <p style="color: var(--muted);">Suscr√≠bete para recibir titulares destacados cada ma√±ana.</p>
        <div style="display:flex; gap:8px;">
          <input type="text" placeholder="Tu correo" aria-label="Correo para bolet√≠n" />
          <button class="btn">Suscribir</button>
        </div>
      </div>
    </aside>
  </div>

  <!-- Floating compose -->
  <button class="compose-btn" id="composeBtn">‚úçÔ∏è Publicar noticia</button>

  <!-- Compose modal -->
  <div class="modal" id="composeModal" aria-hidden="true">
    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="composeTitle">
      <div class="head">
        <h3 id="composeTitle">Nueva noticia</h3>
        <button class="btn ghost" id="closeCompose">Cerrar</button>
      </div>
      <form class="body" id="composeForm">
        <div class="row">
          <label for="title">T√≠tulo</label>
          <input type="text" id="title" name="title" maxlength="140" placeholder="Titular claro y contundente" required />
        </div>
        <div class="row">
          <label for="body">Cuerpo</label>
          <textarea id="body" name="body" placeholder="Describe los hechos de forma breve y verificable" required></textarea>
        </div>

        <div class="row">
          <label>Medios</label>
          <div class="media-picker" id="dropArea">
            <div class="media-actions">
              <input type="file" id="imageInput" accept="image/*" multiple hidden />
              <button type="button" class="btn" id="pickImage">Agregar im√°genes</button>
              <input type="file" id="videoInput" accept="video/*" multiple hidden />
              <button type="button" class="btn" id="pickVideo">Agregar videos</button>
              <span style="color:var(--muted); font-size:13px;">Arrastra y suelta archivos aqu√≠</span>
            </div>
            <div class="previews" id="previews"></div>
          </div>
        </div>

        <div class="row" style="display:grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
          <div>
            <label for="category">Secci√≥n</label>
            <select id="category" name="category" style="width:100%; padding:10px; border-radius:10px; background:#12161c; color:var(--text); border:1px solid #303846;">
              <option value="latest">√öltimas</option>
              <option value="local">Local</option>
              <option value="world">Mundo</option>
              <option value="tech">Tecnolog√≠a</option>
              <option value="sports">Deportes</option>
            </select>
          </div>
          <div>
            <label for="tags">Etiquetas</label>
            <input type="text" id="tags" name="tags" placeholder="Ej: transporte, educaci√≥n" />
          </div>
        </div>

        <div class="error" id="composeError" aria-live="polite"></div>
        <div class="actions">
          <button type="button" class="btn ghost" id="clearMedia">Limpiar medios</button>
          <button type="submit" class="btn primary">Publicar</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Login/Register modal -->
  <div class="modal" id="authModal" aria-hidden="true">
    <div class="dialog" role="dialog" aria-modal="true" aria-labelledby="authTitle">
      <div class="head">
        <h3 id="authTitle">Acceder</h3>
        <button class="btn ghost" id="closeAuth">Cerrar</button>
      </div>
      <form class="body" id="authForm">
        <div class="row">
          <label for="authMode">Modo</label>
          <select id="authMode" style="width:100%; padding:10px; border-radius:10px; background:#12161c; color:var(--text); border:1px solid #303846;">
            <option value="login">Iniciar sesi√≥n</option>
            <option value="register">Crear cuenta</option>
          </select>
        </div>
        <div class="row">
          <label for="email">Correo</label>
          <input type="email" id="email" name="email" placeholder="tucorreo@ejemplo.com" required />
        </div>
        <div class="row" id="nameRow" class="hidden">
          <label for="displayName">Nombre p√∫blico</label>
          <input type="text" id="displayName" name="displayName" placeholder="Tu nombre o medio" />
        </div>
        <div class="row">
          <label for="password">Contrase√±a</label>
          <input type="password" id="password" name="password" placeholder="M√≠nimo 6 caracteres" minlength="6" required />
        </div>
        <div class="error" id="authError" aria-live="polite"></div>
        <div class="actions">
          <button type="submit" class="btn primary" id="authSubmit">Continuar</button>
        </div>
      </form>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script>
    // --- State & Storage -----------------------------------------------------
    const STORAGE = {
      users: 'pd_users',
      session: 'pd_session',
      posts: 'pd_posts'
    };

    const state = {
      user: null,
      media: [], // {type: 'image'|'video', name, dataURL}
      filter: 'all',
      view: 'latest'
    };

    const el = (sel) => document.querySelector(sel);
    const els = (sel) => Array.from(document.querySelectorAll(sel));

    // --- Utils ---------------------------------------------------------------
    const toast = (msg) => {
      const t = el('#toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 1800);
    };

    const sanitize = (str) => (str || '')
      .replace(/[<>&]/g, (c) => ({'<':'&lt;','>':'&gt;','&':'&amp;'}[c]))
      .trim();

    const loadJSON = (key, fallback) => {
      try { return JSON.parse(localStorage.getItem(key)) ?? fallback; }
      catch { return fallback; }
    };
    const saveJSON = (key, value) => localStorage.setItem(key, JSON.stringify(value));

    const nowISO = () => new Date().toISOString();
    const fmtTime = (iso) => {
      const d = new Date(iso);
      return d.toLocaleString('es-ES', { hour: '2-digit', minute: '2-digit', day: '2-digit', month: 'short' });
    };

    // --- Auth ---------------------------------------------------------------
    const refreshSessionUI = () => {
      const session = loadJSON(STORAGE.session, null);
      state.user = session;
      const signed = !!session;
      el('#authSigned').classList.toggle('hidden', !signed);
      el('#logout').classList.toggle('hidden', !signed);
      el('#openLogin').classList.toggle('hidden', signed);
      el('#openRegister').classList.toggle('hidden', signed);
      if (signed) {
        el('#userName').textContent = session.displayName || session.email.split('@')[0];
        el('#userHandle').textContent = '@' + (session.handle || session.email.split('@')[0]);
      }
    };

    const register = ({ email, password, displayName }) => {
      email = email.toLowerCase();
      const users = loadJSON(STORAGE.users, []);
      if (users.some(u => u.email === email)) throw new Error('Ese correo ya est√° registrado.');
      const handle = email.split('@')[0];
      users.push({ email, password, displayName, handle, createdAt: nowISO() });
      saveJSON(STORAGE.users, users);
      saveJSON(STORAGE.session, { email, displayName, handle });
      toast('Cuenta creada');
      refreshSessionUI();
    };

    const login = ({ email, password }) => {
      email = email.toLowerCase();
      const users = loadJSON(STORAGE.users, []);
      const u = users.find(u => u.email === email && u.password === password);
      if (!u) throw new Error('Datos inv√°lidos. Verifica correo y contrase√±a.');
      saveJSON(STORAGE.session, { email: u.email, displayName: u.displayName, handle: u.handle });
      toast('Sesi√≥n iniciada');
      refreshSessionUI();
    };

    const logout = () => {
      localStorage.removeItem(STORAGE.session);
      toast('Sesi√≥n cerrada');
      refreshSessionUI();
    };

    // --- Posts --------------------------------------------------------------
    const getPosts = () => loadJSON(STORAGE.posts, []);
    const setPosts = (list) => saveJSON(STORAGE.posts, list);

    const addPost = (post) => {
      const list = getPosts();
      list.unshift(post); // newest first
      setPosts(list);
    };

    const buildMediaGrid = (media) => {
      if (!media?.length) return '';
      const items = media.map(m => {
        if (m.type === 'image') {
          return `<img src="${m.dataURL}" alt="${sanitize(m.name)}">`;
        } else {
          return `<video src="${m.dataURL}" controls playsinline></video>`;
        }
      }).join('');
      const gridClass = media.length === 1 ? 'gallery one' : 'gallery';
      return `<div class="${gridClass}">${items}</div>`;
    };

    const renderFeed = () => {
      const feed = el('#feed');
      const posts = getPosts()
        .filter(p => p.view === state.view)
        .filter(p => {
          if (state.filter === 'all') return true;
          if (state.filter === 'text') return !p.media?.length;
          if (state.filter === 'image') return p.media?.some(m => m.type === 'image');
          if (state.filter === 'video') return p.media?.some(m => m.type === 'video');
        });

      if (!posts.length) {
        feed.innerHTML = `
          <div class="card">
            <h3>Sin noticias a√∫n</h3>
            <p>Publica la primera historia con el bot√≥n ‚ÄúPublicar noticia‚Äù.</p>
          </div>`;
        return;
      }

      feed.innerHTML = posts.map(p => `
        <article class="card">
          <div class="meta">
            <span>${sanitize(p.authorName)} <span style="color:var(--muted);">@${sanitize(p.authorHandle)}</span></span>
            <span>‚Ä¢</span>
            <span>${fmtTime(p.createdAt)}</span>
            ${p.tags ? `<span>‚Ä¢</span><span>#${sanitize(p.tags)}</span>` : ''}
          </div>
          <h3>${sanitize(p.title)}</h3>
          <p>${sanitize(p.body)}</p>
          ${buildMediaGrid(p.media)}
          <div class="toolbar">
            <button>üí¨ Comentar</button>
            <button>üîÅ Compartir</button>
            <button>‚ù§Ô∏è Me gusta</button>
          </div>
        </article>
      `).join('');
    };

    // --- Media handling -----------------------------------------------------
    const resetMedia = () => {
      state.media = [];
      el('#previews').innerHTML = '';
    };

    const addFiles = async (files) => {
      const tasks = Array.from(files).slice(0, 6).map(file => new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = () => {
          const type = file.type.startsWith('video') ? 'video' : 'image';
          resolve({ type, name: file.name, dataURL: reader.result });
        };
        reader.readAsDataURL(file);
      }));
      const results = await Promise.all(tasks);
      state.media.push(...results);
      renderPreviews();
    };

    const renderPreviews = () => {
      const wrap = el('#previews');
      wrap.innerHTML = state.media.map((m, idx) => `
        <div class="preview">
          ${m.type === 'image' ? `<img src="${m.dataURL}" alt="${sanitize(m.name)}">` : `<video src="${m.dataURL}" controls></video>`}
          <button type="button" class="remove" data-index="${idx}">Eliminar</button>
        </div>
      `).join('');
      wrap.querySelectorAll('.remove').forEach(btn => {
        btn.addEventListener('click', (e) => {
          const i = Number(e.currentTarget.dataset.index);
          state.media.splice(i, 1);
          renderPreviews();
        });
      });
    };

    // Drag & drop
    const dropArea = el('#dropArea');
    ['dragenter','dragover'].forEach(evt => dropArea.addEventListener(evt, (e) => {
      e.preventDefault(); e.stopPropagation();
      dropArea.style.borderColor = '#4aa3ff';
    }));
    ['dragleave','drop'].forEach(evt => dropArea.addEventListener(evt, (e) => {
      e.preventDefault(); e.stopPropagation();
      dropArea.style.borderColor = '#384355';
    }));
    dropArea.addEventListener('drop', (e) => {
      const files = e.dataTransfer.files;
      addFiles(files);
    });

    // --- Compose modal ------------------------------------------------------
    const openCompose = () => {
      const signed = !!loadJSON(STORAGE.session, null);
      if (!signed) {
        openAuth('login');
        toast('Primero inicia sesi√≥n');
        return;
      }
      el('#composeModal').classList.add('open');
      el('#composeModal').setAttribute('aria-hidden', 'false');
      el('#composeError').textContent = '';
      el('#composeForm').reset();
      resetMedia();
    };
    const closeCompose = () => {
      el('#composeModal').classList.remove('open');
      el('#composeModal').setAttribute('aria-hidden', 'true');
    };

    // --- Auth modal ---------------------------------------------------------
    const openAuth = (mode = 'login') => {
      el('#authModal').classList.add('open');
      el('#authModal').setAttribute('aria-hidden', 'false');
      el('#authMode').value = mode;
      el('#authError').textContent = '';
      el('#authForm').reset();
      updateAuthMode();
    };
    const closeAuth = () => {
      el('#authModal').classList.remove('open');
      el('#authModal').setAttribute('aria-hidden', 'true');
    };
    const updateAuthMode = () => {
      const mode = el('#authMode').value;
      el('#authTitle').textContent = mode === 'login' ? 'Iniciar sesi√≥n' : 'Crear cuenta';
      el('#nameRow').style.display = mode === 'register' ? 'grid' : 'none';
    };

    // --- Events -------------------------------------------------------------
    // Sidebar view
    els('.nav button').forEach(b => b.addEventListener('click', () => {
      els('.nav button').forEach(x => x.classList.remove('active'));
      b.classList.add('active');
      state.view = b.dataset.view;
      renderFeed();
    }));

    // Filters
    els('.chip').forEach(c => c.addEventListener('click', () => {
      els('.chip').forEach(x => x.classList.remove('active'));
      c.classList.add('active');
      state.filter = c.dataset.filter;
      renderFeed();
    }));

    // Compose
    el('#composeBtn').addEventListener('click', openCompose);
    el('#closeCompose').addEventListener('click', closeCompose);
    el('#pickImage').addEventListener('click', () => el('#imageInput').click());
    el('#pickVideo').addEventListener('click', () => el('#videoInput').click());
    el('#imageInput').addEventListener('change', (e) => addFiles(e.target.files));
    el('#videoInput').addEventListener('change', (e) => addFiles(e.target.files));
    el('#clearMedia').addEventListener('click', resetMedia);

    el('#composeForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const err = el('#composeError');
      err.textContent = '';

      const title = sanitize(el('#title').value);
      const body = sanitize(el('#body').value);
      const category = el('#category').value;
      const tags = sanitize(el('#tags').value);
      if (!title || !body) {
        err.textContent = 'T√≠tulo y cuerpo son obligatorios.';
        return;
      }
      const session = loadJSON(STORAGE.session, null);
      const post = {
        id: crypto.randomUUID(),
        title, body, tags,
        media: state.media.slice(0,4),
        authorEmail: session.email,
        authorName: session.displayName || session.email.split('@')[0],
        authorHandle: session.handle,
        createdAt: nowISO(),
        view: category
      };
      addPost(post);
      toast('Noticia publicada');
      closeCompose();
      renderFeed();
    });

    // Auth
    el('#openLogin').addEventListener('click', () => openAuth('login'));
    el('#openRegister').addEventListener('click', () => openAuth('register'));
    el('#closeAuth').addEventListener('click', closeAuth);
    el('#authMode').addEventListener('change', updateAuthMode);
    el('#logout').addEventListener('click', logout);

    el('#authForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const mode = el('#authMode').value;
      const email = el('#email').value;
      const password = el('#password').value;
      const displayName = el('#displayName').value;
      const err = el('#authError');
      err.textContent = '';

      try {
        if (mode === 'register') {
          if (!displayName.trim()) throw new Error('Ingresa un nombre p√∫blico.');
          register({ email, password, displayName });
        } else {
          login({ email, password });
        }
        closeAuth();
      } catch (ex) {
        err.textContent = ex.message || 'Error de autenticaci√≥n.';
      }
    });

    // --- Boot ---------------------------------------------------------------
    (function init(){
      refreshSessionUI();
      if (!getPosts().length) {
        // Seed demo posts
        const demo = [
          {
            id: crypto.randomUUID(),
            title: 'Plan de movilidad urbana avanza con nuevos corredores',
            body: 'La autoridad inform√≥ la ampliaci√≥n de rutas y la integraci√≥n de sistemas de pago digitales.',
            tags: 'movilidad, ciudad',
            media: [],
            authorEmail: 'redaccion@medio.com',
            authorName: 'Redacci√≥n',
            authorHandle: 'medio',
            createdAt: nowISO(),
            view: 'latest'
          },
          {
            id: crypto.randomUUID(),
            title: 'Presentan centro de innovaci√≥n en IA',
            body: 'El nuevo hub busca impulsar proyectos de datos y aprendizaje autom√°tico en la regi√≥n.',
            tags: 'tecnolog√≠a, innovaci√≥n',
            media: [],
            authorEmail: 'tech@medio.com',
            authorName: 'Tecnolog√≠a',
            authorHandle: 'tecnologia',
            createdAt: nowISO(),
            view: 'tech'
          }
        ];
        setPosts(demo);
      }
      renderFeed();
    })();

    // Close modals on Escape
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closeCompose(); closeAuth();
      }
    });
  </script>
</body>
</html>
