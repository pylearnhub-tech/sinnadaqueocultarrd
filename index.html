<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>El Metro Diario — Hilo profesional</title>
  <style>
    :root{
      --bg:#0b0e11; --card:#12161a; --text:#e8edf2; --muted:#9fb0c0;
      --accent:#1f67ff; --accent2:#ff6a3d; --border:#20252b; --card2:#0f1418;
      --headline:#f7fafc; --body:#dfe7ef; --shadow:0 20px 48px rgba(0,0,0,.35);
      --ok:#39d98a; --warn:#ffcf5a; --err:#ff6b6b;
    }
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    a{color:var(--accent);text-decoration:none}
    img{max-width:100%;display:block}
    header{position:sticky;top:0;z-index:1000;background:rgba(11,14,17,0.8);border-bottom:1px solid var(--border)}
    .nav{display:flex;justify-content:space-between;align-items:center;padding:12px 16px;max-width:1200px;margin:0 auto}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:38px;height:38px;border-radius:8px;background:linear-gradient(135deg,var(--accent),var(--accent2))}
    .brand h1{font-size:20px;margin:0;color:var(--headline)}
    .actions{display:flex;gap:10px;align-items:center}
    .btn{padding:8px 12px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:var(--text);cursor:pointer}
    .btn.primary{background:linear-gradient(135deg,var(--accent),#4a86ff);color:white}
    main{max-width:1200px;margin:24px auto;padding:0 16px;display:grid;grid-template-columns:1.6fr .9fr;gap:20px}
    .feed{background:var(--card);border:1px solid var(--border);border-radius:16px;overflow:hidden}
    .section-title{padding:12px 14px;border-bottom:1px solid var(--border)}
    .thread{display:flex;flex-direction:column;align-items:flex-start}
    .post{width:100%;display:grid;grid-template-columns:56px 1fr;gap:12px;padding:14px 16px;border-bottom:1px solid var(--border)}
    .avatar{width:40px;height:40px;border-radius:999px;overflow:hidden;background:var(--card2)}
    .avatar img{width:100%;height:100%;object-fit:cover}
    .postHeader{display:flex;gap:8px;align-items:center}
    .postTitle{font-size:20px;margin:0;color:var(--headline);font-weight:800}
    .postExcerpt{font-size:15px;color:var(--body);margin-top:6px}
    .thumb{margin-top:10px;border-radius:10px;overflow:hidden}
    .thumb img{width:100%;height:auto;object-fit:cover}
    .postActions{display:flex;gap:12px;margin-top:10px}
    .react{font-size:13px;color:var(--muted);display:flex;gap:6px;align-items:center;cursor:pointer}
    .readerPanel{display:none;grid-column:1 / -1}
    .readerLayout{display:grid;grid-template-columns:1.6fr .9fr;gap:20px}
    .readerCard{background:var(--card);border:1px solid var(--border);border-radius:16px}
    .reader{padding:18px;max-width:900px;margin:0 auto}
    .readerTitle{margin:16px 0 6px;font-size:34px;color:var(--headline)}
    .readerAuthor{display:flex;gap:10px;align-items:center;padding:10px 0;border-top:1px solid var(--border)}
    .readerAuthor .profileAvatar{width:36px;height:36px;border-radius:999px;overflow:hidden}
    .readerBody{margin-top:16px;line-height:1.9;font-size:18px;color:var(--body);text-align:center}
  </style>
</head>
<body>
  <header>
    <div class="nav">
      <div class="brand"><div class="logo"></div><h1>El Metro Diario</h1></div>
      <div class="actions">
        <button id="loginBtn" class="btn">Iniciar sesión</button>
        <button id="openComposer" class="btn primary">Publicar</button>
      </div>
    </div>
  </header>
  <main>
    <section class="feed">
      <div class="section-title"><strong>Portada</strong></div>
      <div id="thread" class="thread"></div>
    </section>
    <aside class="rightbar">
      <div class="section-title"><strong>Autores activos</strong></div>
      <div id="authorsList"></div>
    </aside>
    <section class="readerPanel" id="readerPanel">
      <div class="readerLayout">
        <div class="readerCard">
          <div class="reader">
            <h1 class="readerTitle" id="viewTitle"></h1>
            <div class="readerAuthor">
              <div class="profileAvatar"><img id="readerAuthorImg" alt=""></div>
              <div><div id="readerAuthorName"></div><div id="readerAuthorEmail" style="font-size:12px;color:var(--muted)"></div></div>
            </div>
            <div class="readerBody" id="viewContent"></div>
          </div>
        </div>
        <aside class="rightbar">
          <div class="section-title"><strong>Panel lectura</strong></div>
          <div id="readerSummary"></div>
        </aside>
      </div>
    </section>
  </main>
  <script>
    const state={posts:[],localPosts:[],user:JSON.parse(localStorage.getItem("sessionUser")||"null")};
    function renderThread(){
      const list=document.getElementById("thread");list.innerHTML="";
      const items=[...state.localPosts,...state.posts];
      items.forEach(p=>{
        const container=document.createElement("article");container.className="post";
        const avatarHtml=p.author?.picture?`<img src="${p.author.picture}" alt="">`:`<span>ED</span>`;
        const thumb= (p.images&&p.images[0]) || (p.content?extractImages(p.content)[0]:"");
        container.innerHTML=`
          <div class="avatar">${avatarHtml}</div>
          <div>
            <div class="postHeader"><h3 class="postTitle"><a href="#" class="open-post">${p.title||"(Sin título)"}</a></h3></div>
            <div class="postExcerpt">${escapeHtml(extractExcerpt(p.content||"",200))}</div>
            ${thumb?`<div class="thumb"><img src="${thumb}" alt=""></div>`:""}
          </div>`;
        list.appendChild(container);
      });
    }
    function extractImages(html){const doc=new DOMParser().parseFromString(html,"text/html");return[...doc.querySelectorAll("img")].map(i=>i.src);}
    function extractExcerpt(html,len){const text=new DOMParser().parseFromString(html,"text/html").body.textContent||"";return text.length>len?text.slice(0,len)+"…":text;}
    function escapeHtml(s=""){return s.replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));}
    renderThread();
  </script>
</body>
</html>
